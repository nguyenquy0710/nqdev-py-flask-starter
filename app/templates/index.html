<!DOCTYPE html>
<html lang="vi">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, viewport-fit=cover" />
    <meta name="DC.language" content="scheme=utf-8 content=vi" />

    <title>Stock Tracker</title>

    <link rel="icon" href="https://cdn-s3-001.quyit.id.vn/gitbook/blogs/logo_nqdev_512x512.png" sizes="32x32" />
    <link rel="icon" href="https://cdn-s3-001.quyit.id.vn/gitbook/blogs/logo_nqdev_512x512.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="https://cdn-s3-001.quyit.id.vn/gitbook/blogs/logo_nqdev_512x512.png" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <!-- Bootstrap JS (th√™m jQuery n·∫øu d√πng) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Th√™m Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Luxon adapter -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.js"></script>

    <!-- Zoom plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.umd.min.js"></script>

    <!-- Datalabels plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <style type="text/css">
      /* T√πy ch·ªânh m√†u n·ªÅn v√† vi·ªÅn c·ªßa tooltip */
      .tooltip-inner {
        background-color: #4CAF50;
        /* M√†u n·ªÅn c·ªßa tooltip */
        color: white;
        /* M√†u ch·ªØ */
        font-size: 14px;
        /* K√≠ch th∆∞·ªõc ch·ªØ */
        border-radius: 8px;
        /* Bo tr√≤n vi·ªÅn tooltip */
        padding: 10px 15px;
        /* Padding n·ªôi dung */
      }

      /* T√πy ch·ªânh vi·ªÅn c·ªßa tooltip */
      .tooltip-arrow {
        border-top-color: #4CAF50;
        /* M√†u vi·ªÅn c·ªßa tooltip */
      }

      /* T√πy ch·ªânh khi hover v√†o tooltip */
      .tooltip-inner:hover {
        background-color: #45a049;
        /* M√†u n·ªÅn khi hover v√†o tooltip */
      }
    </style>

  </head>

  <body class="container py-5">

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <h2 class="mb-4">
      üìà Danh s√°ch theo d√µi ch·ª©ng kho√°n
      <br>
      <small style="font-size: medium;" class="text-muted">D·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª´ <a href="https://finance.vietstock.vn" target="_blank"
          class="text-decoration-none">finance.vietstock.vn</a></small>
    </h2>

    <form class="row row-cols-lg-auto g-2 align-items-center mb-4" method="post" action="/add">
      <div class="col">
        <input name="symbol" class="form-control" placeholder="M√£ (VD: MBB)" required>
      </div>
      <div class="col">
        <input name="buy_price" type="number" class="form-control" placeholder="Gi√° mua" step="0.01" required>
      </div>
      <div class="col">
        <input name="sell_price" type="number" class="form-control" placeholder="Gi√° b√°n k·ª≥ v·ªçng" step="0.01" required>
      </div>
      <div class="col">
        <input name="profit_loss" type="number" class="form-control" placeholder="% L√£i/L·ªó k·ª≥ v·ªçng" step="0.01" required>
      </div>
      <div class="col">
        <button type="submit" class="btn btn-primary">Th√™m m√£</button>
      </div>
      <div class="col">
        <button type="button" class="btn btn-secondary" onclick="location.reload()">Reload</button>
      </div>
    </form>

    <div class="row row-cols-lg-auto align-items-center g-2 mb-3">
      <!-- Th√™m n√∫t ‚Äúüîç L·ªçc m√£ ƒëang l√£i‚Äù -->
      <div class="col-auto">
        <button onclick="filterRows(true)" class="btn btn-outline-success btn-sm">üîç Ch·ªâ hi·ªÉn th·ªã m√£ ƒëang l√£i</button>
        <button onclick="filterRows(false)" class="btn btn-outline-secondary btn-sm">Hi·ªÉn th·ªã t·∫•t c·∫£</button>
      </div>

      <!-- Label -->
      <div class="col-auto">
        <label for="reload-interval" class="col-form-label col-form-label-sm">T·∫£i l·∫°i m·ªói:</label>
      </div>

      <!-- Dropdown -->
      <div class="col-auto">
        <select id="reload-interval" class="form-select form-select-sm w-auto">
          <option value="30000">30 gi√¢y</option>
          <option value="60000" selected>1 ph√∫t</option>
          <option value="120000">2 ph√∫t</option>
          <option value="300000">5 ph√∫t</option>
        </select>
      </div>

      <!-- N√∫t reload -->
      <div class="col-auto">
        <button id="manual-reload" class="btn btn-outline-secondary btn-sm" title="T·∫£i l·∫°i ngay">
          &#x21bb; <!-- Unicode cho bi·ªÉu t∆∞·ª£ng reload -->
        </button>
      </div>
    </div>

    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>M√£</th>
          <th>Gi√° g·∫ßn nh·∫•t</th>
          <th>Gi√° mua</th>
          <th>Gi√° b√°n k·ª≥ v·ªçng</th>
          <th>% L√£i/L·ªó k·ª≥ v·ªçng</th>
          <th>% L√£i/L·ªó th·ª±c t·∫ø</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        {% for symbol, price in prices.items() %}
        <tr>
          <td><a href="/detail/{{ symbol }}">{{ symbol }}</a></td>
          <td>{{ price }}</td>
          <td>{{ symbol_info[symbol]['buy_price'] }}</td>
          <td>{{ symbol_info[symbol]['sell_price'] }}</td>
          <td>{{ symbol_info[symbol]['profit_loss'] }}%</td>
          <td class="
            {% if actual_profit[symbol] != '-' %}
              {% if actual_profit[symbol] > 0 %}
                table-success
              {% elif actual_profit[symbol] < 0 %}
                table-danger
              {% endif %}
            {% endif %}
          ">
            {% if actual_profit[symbol] != '-' %}
            <span class="{% if actual_profit[symbol] > 0 %}text-success{% else %}text-danger{% endif %}">
              {{ actual_profit[symbol] }}%
            </span>
            {% else %}
            -
            {% endif %}
          </td>
          <td>
            <!-- Xem bi·ªÉu ƒë·ªì -->
            <button class="btn btn-sm btn-warning btn-sm ms-1 mb-1" onclick="updateChart('{{ symbol }}')" title="Xem bi·ªÉu ƒë·ªì">
              <i class="fas fa-eye"></i> Xem
            </button>
            <!-- L√†m m·ªõi bi·ªÉu ƒë·ªì -->
            <a href="/refresh/{{ symbol }}" class="btn btn-sm btn-info btn-sm ms-1 mb-1" title="L√†m m·ªõi bi·ªÉu ƒë·ªì">
              <i class="fas fa-sync-alt"></i> Refresh
            </a>
            <!-- X√≥a v·ªõi x√°c nh·∫≠n -->
            <button class="btn btn-sm btn-danger btn-sm ms-1 mb-1" onclick="confirmDelete('{{ symbol }}')" title="X√≥a bi·ªÉu ƒë·ªì">
              <i class="fas fa-trash-alt"></i> Xo√°
            </button>
          </td>
          {% endfor %}
      </tbody>
    </table>

    <hr />
    <div class="mt-4">
      <h5>üìà Ch·ªâ b√°o k·ªπ thu·∫≠t (M·ªõi nh·∫•t)</h5>

      <!-- Grid system c·ªßa Bootstrap -->
      <div class="row">
        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="ƒê∆∞·ªùng Trung B√¨nh H√≤a Quy·∫øt trong 5 giai ƒëo·∫°n. ƒê√¢y l√† ch·ªâ b√°o ph·∫£n ·ª©ng nhanh h∆°n v·ªõi c√°c thay ƒë·ªïi v·ªÅ gi√° trong th·ªã tr∆∞·ªùng.">EMA_5</strong>
            <span id="indicatorsEMA_5">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="ƒê∆∞·ªùng Trung B√¨nh H√≤a Quy·∫øt trong 10 giai ƒëo·∫°n. EMA_10 ph·∫£n √°nh nhanh c√°c thay ƒë·ªïi trong gi√° v√† ƒë∆∞·ª£c d√πng ƒë·ªÉ ph√°t hi·ªán t√≠n hi·ªáu mua/b√°n ng·∫Øn h·∫°n.">EMA_10</strong>
            <span id="indicatorsEMA_10">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="ƒê∆∞·ªùng Trung B√¨nh ƒê∆°n Gi·∫£n trong 20 giai ƒëo·∫°n, ƒë∆∞·ª£c d√πng ƒë·ªÉ nh·∫≠n di·ªán xu h∆∞·ªõng gi√° trung h·∫°n.">MA20</strong>
            <span id="indicatorsMA20">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="Ch·ªâ s·ªë s·ª©c m·∫°nh t∆∞∆°ng ƒë·ªëi (Relative Strength Index) ƒëo m·ª©c ƒë·ªô qu√° mua/qu√° b√°n trong th·ªã tr∆∞·ªùng, v·ªõi 70 l√† qu√° mua v√† 30 l√† qu√° b√°n.">RSI</strong>
            <span id="indicatorsRSI">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="ƒê∆∞·ªùng Trung B√¨nh ƒê∆°n Gi·∫£n trong 5 giai ƒëo·∫°n, gi√∫p theo d√µi bi·∫øn ƒë·ªông gi√° ng·∫Øn h·∫°n nhanh ch√≥ng.">SMA_5</strong>
            <span id="indicatorsSMA_5">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="ƒê∆∞·ªùng Trung B√¨nh ƒê∆°n Gi·∫£n trong 10 giai ƒëo·∫°n. Ch·ªâ b√°o n√†y gi√∫p nh·∫≠n di·ªán c√°c xu h∆∞·ªõng ng·∫Øn h·∫°n c·ªßa th·ªã tr∆∞·ªùng.">SMA_10</strong>
            <span id="indicatorsSMA_10">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="D·∫£i Bollinger tr√™n, x√°c ƒë·ªãnh m·ª©c kh√°ng c·ª± c·ªßa gi√° v√† c√≥ th·ªÉ cho t√≠n hi·ªáu khi th·ªã tr∆∞·ªùng qu√° mua (overbought).">Upper
              Bollinger
              Band</strong>
            <span id="indicatorsUpperBB">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="D·∫£i Bollinger d∆∞·ªõi th·ªÉ hi·ªán m·ª©c h·ªó tr·ª£ c·ªßa gi√°, gi√∫p x√°c ƒë·ªãnh khi th·ªã tr∆∞·ªùng qu√° b√°n (oversold).">Lower Bollinger
              Band</strong>
            <span id="indicatorsLowerBB">0</span>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="d-flex justify-content-between">
            <strong data-bs-toggle="tooltip" data-bs-placement="top"
              title="Gi√° hi·ªán t·∫°i c·ªßa t√†i s·∫£n, l√† gi√° tr·ªã giao d·ªãch cu·ªëi c√πng ƒë∆∞·ª£c th·ª±c hi·ªán tr√™n th·ªã tr∆∞·ªùng.">Price</strong>
            <span id="indicatorsPrice">0</span>
          </div>
        </div>
      </div>
    </div>

    <div class="mb-4">
      <h5 class="mt-5">Bi·ªÉu ƒë·ªì gi√° g·∫ßn ƒë√¢y - <span id="priceSymbol">{{ first_symbol }}</span></h5>
      <canvas id="priceChart" height="100"></canvas>
    </div>

    <script type="text/javascript">
      // K√≠ch ho·∫°t tooltip cho t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ c√≥ data-bs-toggle="tooltip"
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    </script>


    <script type="text/javascript">
      var chart = undefined;

      function drawChart(timestamps, prices, symbol) {
        // T·∫°o m·∫£ng [{x, y}] t·ª´ timestamp v√† prices
        const chartData = timestamps.map((ts, i) => ({
          x: ts,      // ISO string
          y: prices[i]
        }));

        if (symbol) {
          document.getElementById('priceSymbol').innerHTML = symbol;
        }

        const ctx = document.getElementById('priceChart').getContext('2d');
        if (chart) {
          // Khi c·∫ßn clear chart (x√≥a bi·ªÉu ƒë·ªì)
          chart.destroy();
        }

        // T√≠nh to√°n gi√° tr·ªã min v√† max
        // const minPrice = Math.min(...prices);
        // const maxPrice = Math.max(...prices);
        // const yMin = minPrice - 5; // Gi·ªõi h·∫°n d∆∞·ªõi
        // const yMax = maxPrice + 5; // Gi·ªõi h·∫°n tr√™n

        const data = {
          labels: timestamps, //.map(ts => new Date(ts)),  // chuy·ªÉn ISO ‚Üí Date object
          datasets: [{
            label: 'Gi√° g·∫ßn ƒë√¢y',
            // data: prices,
            data: chartData,
            borderColor: 'blue',
            backgroundColor: "rgba(0, 0, 255, 0.1)",
            fill: true,
            tension: 0.1
          }]
        };

        const config = {
          type: 'line',
          data: data,
          options: {
            responsive: true,
            // parsing: false, // ‚ùå B·ªè d√≤ng n√†y, v√¨ Chart.js s·∫Ω kh√¥ng t·ª± ƒë·ªông hi·ªÉu x/y.
            scales: {
              x: {
                type: 'time',
                time: {
                  unit: 'hour',               // Tr·ª•c x s·∫Ω chia theo t·ª´ng ph√∫t (c√≥ th·ªÉ l√† second, minute, hour, day, v.v.)
                  parser: 'HH:mm:ss d/M/yyyy',  // C·∫•u h√¨nh ƒë·ªÉ hi·ªÉu ƒë·ªãnh d·∫°ng label c·ªßa b·∫°n
                  tooltipFormat: 'dd/MM/yyyy HH:mm:ss',    // ƒê·ªãnh d·∫°ng th·ªùi gian khi hover v√†o ƒëi·ªÉm d·ªØ li·ªáu (hi·ªán trong tooltip)
                  displayFormats: {             // T√πy ch·ªânh hi·ªÉn th·ªã nh√£n tr·ª•c x v·ªõi t·ª´ng unit
                    minute: 'HH:mm dd/MM',
                    second: 'HH:mm:ss'
                  },
                  zone: 'Asia/Ho_Chi_Minh'      // Y√™u c·∫ßu hi·ªÉn th·ªã theo m√∫i gi·ªù Vi·ªát Nam (UTC+7) ‚Äî ch·ªâ ho·∫°t ƒë·ªông khi b·∫°n d√πng luxon adapter
                },
                adapters: {
                  luxon: {
                    zone: 'Asia/Ho_Chi_Minh',
                    locale: 'vi'   // üí° Quan tr·ªçng: s·ª≠ d·ª•ng ƒë·ªãnh d·∫°ng ti·∫øng Vi·ªát
                  }
                },
                title: {
                  display: true,
                  text: 'Th·ªùi gian (UTC+7)'
                }
              },
              y: {
                beginAtZero: false,
                // min: yMin, // Gi·ªõi h·∫°n d∆∞·ªõi
                // max: yMax, // Gi·ªõi h·∫°n tr√™n
                title: {
                  display: true,
                  text: "Gi√°"
                }
              }
            },
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false
              },
              zoom: {
                pan: {
                  enabled: true,
                  mode: 'x',
                  modifierKey: 'ctrl'  // nh·∫•n Ctrl + k√©o chu·ªôt ƒë·ªÉ pan
                },
                zoom: {
                  wheel: {
                    enabled: true
                  },
                  pinch: {
                    enabled: true
                  },
                  mode: 'x'
                }
              },
              datalabels: {
                align: 'top',
                anchor: 'end',
                color: 'black',
                font: {
                  size: 10
                },
                formatter: function (value) {
                  const dt = luxon.DateTime.fromISO(value.x, { zone: 'Asia/Ho_Chi_Minh' });
                  return dt.toFormat("dd/MM/yyyy HH:mm");
                }
              },
            }
          }
        };

        // T·∫°o chart
        chart = new Chart(ctx, config);
      }

      // Function ƒë·ªãnh d·∫°ng gi√° tr·ªã v·ªõi 3 ch·ªØ s·ªë th·∫≠p ph√¢n v√† x·ª≠ l√Ω NaN
      function formatNumber(value) {
        if (typeof value === 'number' && !isNaN(value)) {
          return value.toFixed(3);  // N·∫øu l√† s·ªë h·ª£p l·ªá, l√†m tr√≤n t·ªõi 3 ch·ªØ s·ªë
        } else {
          return 'N/A';  // N·∫øu l√† NaN ho·∫∑c kh√¥ng ph·∫£i l√† s·ªë, tr·∫£ v·ªÅ 'N/A'
        }
      }

      // H√†m c·∫≠p nh·∫≠t d·ªØ li·ªáu Indicators
      function fetchIndicators(symbol) {
        // G·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu ch·ªâ b√°o k·ªπ thu·∫≠t
        fetch(`/api/chart/indicators/${symbol}`)
          .then(response => response.json())  // Chuy·ªÉn ph·∫£n h·ªìi th√†nh JSON
          .then(data => {
            // Ki·ªÉm tra n·∫øu API tr·∫£ v·ªÅ l·ªói
            if (data.error) {
              console.error("L·ªói: ", data.error);
              return;
            }

            // C·∫≠p nh·∫≠t c√°c gi√° tr·ªã v√†o c√°c ph·∫ßn t·ª≠ c√≥ id t∆∞∆°ng ·ª©ng v√† ƒë·ªãnh d·∫°ng gi√° tr·ªã v·ªõi 3 ch·ªØ s·ªë th·∫≠p ph√¢n
            document.getElementById('indicatorsMA20').innerText = formatNumber(data.MA20);
            document.getElementById('indicatorsRSI').innerText = formatNumber(data.RSI);
            document.getElementById('indicatorsUpperBB').innerText = formatNumber(data.UpperBB);
            document.getElementById('indicatorsLowerBB').innerText = formatNumber(data.LowerBB);
            document.getElementById('indicatorsEMA_10').innerText = formatNumber(data.EMA_10);
            document.getElementById('indicatorsEMA_5').innerText = formatNumber(data.EMA_5);
            document.getElementById('indicatorsSMA_10').innerText = formatNumber(data.SMA_10);
            document.getElementById('indicatorsSMA_5').innerText = formatNumber(data.SMA_5);
            document.getElementById('indicatorsPrice').innerText = formatNumber(data.price);
          })
          .catch(error => {
            console.error("L·ªói khi g·ªçi API: ", error);
          });
      }


      // H√†m c·∫≠p nh·∫≠t d·ªØ li·ªáu chart
      function updateChart(symbol) {
        console.log("üöÄ QuyNH: updateChart -> symbol", symbol)
        fetch(`/api/chart/${symbol}`)
          .then(r => r.json())
          .then(data => {
            const timestamps = data.timestamps.map(ts => {
              const date = new Date(ts);
              return date.toLocaleString();
            });

            drawChart(timestamps, data.prices, symbol);
          })
          .catch(err => {
            console.warn("‚ö† Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu API", err);

            const now = new Date();
            const timestamps = Array.from({ length: 100 }, (_, i) => {
              const d = new Date(now.getTime() - (99 - i) * 60000);
              return d.toLocaleTimeString();
            });
            const prices = Array.from({ length: 100 }, () => (20 + Math.random() * 2 - 1).toFixed(2));
            drawChart(timestamps, prices, symbol);
          });

        // L·∫•y d·ªØ li·ªáu t·ª´ API
        fetchIndicators(symbol)
      }

      // L·∫•y d·ªØ li·ªáu t·ª´ API
      updateChart(`{{ first_symbol }}`)
    </script>

    <script type="text/javascript">
      function confirmDelete(symbol) {
        Swal.fire({
          title: `X√°c nh·∫≠n xo√° "${symbol}"?`,
          text: "Thao t√°c n√†y s·∫Ω x√≥a to√†n b·ªô d·ªØ li·ªáu!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Xo√°',
          cancelButtonText: 'Hu·ª∑',
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6'
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = `/delete/${symbol}`;
          }
        });
      }
    </script>

    <script type="text/javascript">
      function filterRows(onlyProfit) {
        const rows = document.querySelectorAll("tbody tr");
        rows.forEach(row => {
          const profitCell = row.querySelector("td:nth-child(6)");
          if (!profitCell) return;
          const text = profitCell.textContent.trim().replace('%', '');
          const value = parseFloat(text);

          if (onlyProfit) {
            row.style.display = value > 0 ? "" : "none";
          } else {
            row.style.display = "";
          }
        });
      }
    </script>

    <script type="text/javascript">
      let intervalId;

      function setReloadInterval(ms) {
        clearInterval(intervalId); // X√≥a interval c≈© n·∫øu c√≥
        intervalId = setInterval(() => {
          location.reload();
        }, ms);
      }

      const dropdown = document.getElementById('reload-interval');
      const manualReloadBtn = document.getElementById('manual-reload');

      // ƒê·∫∑t m·∫∑c ƒë·ªãnh ban ƒë·∫ßu l√† 1 ph√∫t
      setReloadInterval(Number(dropdown.value));

      // Khi ng∆∞·ªùi d√πng thay ƒë·ªïi th·ªùi gian reload
      dropdown.addEventListener('change', function () {
        const selectedTime = Number(this.value);
        setReloadInterval(selectedTime);
      });

      manualReloadBtn.addEventListener('click', function () {
        location.reload();
      });
    </script>

  </body>

</html>